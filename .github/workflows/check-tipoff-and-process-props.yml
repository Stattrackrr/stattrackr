name: Check Tipoff and Process Props

on:
  # Run every 10 minutes to check if it's time to process tomorrow's props
  # This ensures we catch the trigger within 10 minutes of the 10-minute mark after tipoff
  schedule:
    - cron: '*/10 * * * *'  # Every 10 minutes
  # Manual trigger (optional)
  workflow_dispatch: {}

jobs:
  check_and_trigger:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    permissions:
      contents: read
      actions: write  # Needed to trigger other workflows
    env:
      PROD_URL: ${{ secrets.PROD_URL }}
      NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
      SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      # Note: GITHUB_TOKEN is automatically provided by GitHub Actions
      # If you need a personal access token with workflow dispatch permissions, use secrets.GITHUB_TOKEN_PAT instead
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Check tipoff and trigger processing
        run: |
          echo "üïê Checking latest tipoff time..."
          node scripts/check-tipoff-and-trigger.js
